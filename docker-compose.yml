services:
  openclaw-gateway:
    image: watink/openclaw:latest
    container_name: openclaw-gateway
    restart: unless-stopped
    ports:
      - "18789:18789"
      # Porta do Canvas Host (A2UI/HTML editável pelo agente)
      - "18793:18793"
    volumes: &openclaw-volumes
      # Configuração (chaves, sessões, canais) - Mapeado para host (Padrão: ./data/config ou /root/openclaw/config)
      - ${OPENCLAW_CONFIG_PATH:-./data/config}:/home/openclaw/.openclaw
      # Socket do Docker para Sandboxing (opcional, mas recomendado para isolamento)
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      # Desabilita mDNS (Bonjour) para evitar anúncios na rede (OpSec/Produção)
      - OPENCLAW_DISABLE_BONJOUR=1
      # Bind LAN (necessário para Traefik alcançar o container)
      - OPENCLAW_GATEWAY_BIND=lan
      # Token de Autenticação Estático (Opcional - para automação/headless)
      # Se definido, o Gateway exigirá este token para conexão.
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN:-}
    # Permite iniciar sem config para rodar o onboard depois
    command: ["openclaw", "gateway", "--allow-unconfigured"]

  # Serviço auxiliar para rodar comandos CLI (onboard, install, etc)
  # Uso: docker compose run --rm openclaw-cli onboard
  openclaw-cli:
    image: watink/openclaw:latest
    container_name: openclaw-cli
    profiles: ["cli"]
    entrypoint: ["openclaw"]
    volumes: *openclaw-volumes
    environment:
      - OPENCLAW_DISABLE_BONJOUR=1

volumes:
  openclaw_home:
    driver: local
